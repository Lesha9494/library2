{% extends 'base.html.twig' %}

{% block title %}Выдачи книг
{% endblock %}

{% block body %}
	<div class="container">
		<div class="header">
			<h1>Выдачи книг</h1>
			<a href="{{ path('app_loan_new') }}" class="btn-new">+ Новая выдача</a>
		</div>

		{% if loans|length > 0 %}
			<table class="loan-table">
				<thead>
					<tr>
						<th>ID</th>
						<th>Читатель</th>
						<th>Книга</th>
						<th>Выдана</th>
						<th>Вернуть до</th>
						<th>Возвращена</th>
						<th>Статус</th>
						<th>Действия</th>
					</tr>
				</thead>
				<tbody>
					{% for loan in loans %}
						<tr>
							<td>{{ loan.id }}</td>
							<td>{{ loan.reader.fullName }}</td>
							<td>
								{% if loan.bookCopy and loan.bookCopy.book %}
									{{ loan.bookCopy.book.title }}
								{% else %}
									Не указана
								{% endif %}
							</td>
							<td>{{ loan.issueDate ? loan.issueDate|date('d.m.Y') : '' }}</td>
							<td>{{ loan.dueDate ? loan.dueDate|date('d.m.Y') : '' }}</td>
							<td>
								{% if loan.returnDate %}
									{{ loan.returnDate|date('d.m.Y') }}
								{% else %}
									<span style="color: #f44336;">Не возвращена</span>
								{% endif %}
							</td>
							<td>
								{% if loan.returnDate %}
									<span class="status-returned">Возвращена</span>
								{% else %}
									{% set today = "now"|date('Y-m-d') %}
									{% set dueDate = loan.dueDate ? loan.dueDate|date('Y-m-d') : '' %}
									{% if dueDate < today %}
										<span class="status-overdue">Просрочена</span>
									{% else %}
										<span class="status-active">На руках</span>
									{% endif %}
								{% endif %}
							</td>
							<td class="actions">
								<a href="{{ path('app_loan_show', {'id': loan.id}) }}" class="btn-view">Просмотр</a>
								<a href="{{ path('app_loan_edit', {'id': loan.id}) }}" class="btn-edit">Изменить</a>
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% else %}
			<div class="empty-state">
				<p>Выдач не найдено</p>
				<a href="{{ path('app_loan_new') }}" class="btn-new">Создать первую выдачу</a>
			</div>
		{% endif %}
	</div>

	<style>
		.container {
			padding: 20px;
		}

		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}

		h1 {
			color: #333;
		}

		.btn-new {
			background: #2196F3;
			color: white;
			padding: 10px 15px;
			border-radius: 4px;
			text-decoration: none;
		}

		.btn-new:hover {
			background: #1976D2;
		}

		.loan-table {
			width: 100%;
			border-collapse: collapse;
			background: white;
		}

		.loan-table th {
			background: #f5f5f5;
			padding: 12px;
			text-align: left;
			border-bottom: 2px solid #ddd;
			font-weight: bold;
		}

		.loan-table td {
			padding: 10px;
			border-bottom: 1px solid #eee;
		}

		.loan-table tr:hover {
			background: #f9f9f9;
		}

		.status-returned {
			background: #4CAF50;
			color: white;
			padding: 3px 8px;
			border-radius: 3px;
			font-size: 12px;
		}

		.status-active {
			background: #2196F3;
			color: white;
			padding: 3px 8px;
			border-radius: 3px;
			font-size: 12px;
		}

		.status-overdue {
			background: #f44336;
			color: white;
			padding: 3px 8px;
			border-radius: 3px;
			font-size: 12px;
		}

		.actions {
			display: flex;
			gap: 5px;
		}

		.btn-view,
		.btn-edit {
			padding: 5px 10px;
			border-radius: 3px;
			text-decoration: none;
			font-size: 14px;
		}

		.btn-view {
			background: #4CAF50;
			color: white;
		}

		.btn-view:hover {
			background: #45a049;
		}

		.btn-edit {
			background: #FF9800;
			color: white;
		}

		.btn-edit:hover {
			background: #F57C00;
		}

		.empty-state {
			text-align: center;
			padding: 40px;
			background: white;
			border-radius: 5px;
			margin-top: 20px;
		}

		.empty-state p {
			margin-bottom: 20px;
			color: #666;
		}
	</style>
{% endblock %}
